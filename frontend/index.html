<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Meeting Watch</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; margin: 0; padding: 0; background:#0b1020; color:#eef1f7; }
    header { padding: 1rem 1.25rem; border-bottom: 1px solid #223; background: #0f1530; position: sticky; top: 0; }
    h1 { margin: 0; font-size: 1.25rem; }
    .wrap { max-width: 1000px; margin: 1rem auto; padding: 0 1rem; }
    .group { margin: 1.5rem 0; }
    .card { background: #121938; border: 1px solid #223; border-radius: 14px; padding: 1rem; margin: 0.75rem 0; box-shadow: 0 4px 16px rgba(0,0,0,0.25); }
    .meta { font-size: 0.95rem; opacity: 0.9; }
    .chips { display: flex; flex-wrap: wrap; gap: .5rem; margin-top: .35rem; }
    .chip { background: #1c264b; border: 1px solid #2a386a; border-radius: 20px; padding: .15rem .6rem; font-size: .8rem; }
    .bullets { margin: .5rem 0 0 .5rem; }
    a { color: #91b6ff; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .small { font-size: .85rem; opacity: .8; }
    .jur { font-weight: bold; font-size: 1.1rem; }
    .empty { opacity: .7; font-style: italic; }
  </style>
</head>
<body>
  <header>
    <h1>Meeting Watch — Future Meetings</h1>
    <div class="small">Auto-updated by scheduled scrapes. Times shown in America/Denver.</div>
  </header>
  <div class="wrap">
    <div id="lastChecked" class="small"></div>
    <div id="content"></div>
  </div>
  <script>
    async function load() {
      // Adjust this path if serving from a different base URL
      const res = await fetch('../data/meetings.json', {cache: 'no-store'});
      const data = await res.json();
      document.getElementById('lastChecked').textContent = 'Last checked (MT): ' + data.last_checked_mt;
      const groups = {};
      for (const m of data.meetings) {
        const key = m.city_or_body || m.jurisdiction || 'Unknown';
        if (!groups[key]) groups[key] = [];
        groups[key].push(m);
      }
      const container = document.getElementById('content');
      container.innerHTML = '';
      const sortedKeys = Object.keys(groups).sort();
      for (const k of sortedKeys) {
        const gDiv = document.createElement('div');
        gDiv.className = 'group';
        const h = document.createElement('div');
        h.className = 'jur';
        h.textContent = k;
        gDiv.appendChild(h);
        for (const m of groups[k]) {
          const c = document.createElement('div');
          c.className = 'card';
          const title = document.createElement('div');
          title.innerHTML = `<strong>${m.date || ''} — ${m.start_time_local || ''} — ${m.meeting_type || ''}</strong>`;
          c.appendChild(title);
          const meta = document.createElement('div');
          meta.className = 'meta';
          meta.textContent = (m.location || 'Location not listed');
          c.appendChild(meta);
          const chips = document.createElement('div');
          chips.className = 'chips';
          const status = document.createElement('span');
          status.className = 'chip';
          status.textContent = m.status || 'Status unknown';
          chips.appendChild(status);
          if (m.agenda_url) {
            const a = document.createElement('a');
            a.href = m.agenda_url;
            a.target = '_blank';
            a.rel = 'noopener';
            a.textContent = 'Agenda';
            const chip = document.createElement('span');
            chip.className = 'chip';
            chip.appendChild(a);
            chips.appendChild(chip);
          }
          c.appendChild(chips);
          const summary = document.createElement('div');
          summary.className = 'bullets';
          if (m.agenda_summary && m.agenda_summary.length) {
            const ul = document.createElement('ul');
            for (const s of m.agenda_summary) {
              const li = document.createElement('li');
              li.textContent = s;
              ul.appendChild(li);
            }
            summary.appendChild(ul);
          } else if (m.agenda_summary && typeof m.agenda_summary === 'string') {
            summary.textContent = m.agenda_summary;
          } else {
            summary.innerHTML = '<span class="empty">Agenda not posted yet</span>';
          }
          c.appendChild(summary);
          gDiv.appendChild(c);
        }
        container.appendChild(gDiv);
      }
    }
    load();
  </script>
</body>
</html>
